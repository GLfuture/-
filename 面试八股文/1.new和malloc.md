1.malloc分配的是物理内存还是虚拟内存？

malloc 分配的是虚拟内存，malloc中含有一个小的内存池，如果分配的内存小于128k，通过系统调用break，大于128k，通过文件映射mmap

new是在free store上分配内存

2.malloc调用后是否立即得到物理内存？

malloc由于创建的时候不会调用构造函数，因此不会映射到物理内存中，只有在初始化后引起缺页中断，才会建立起虚拟内存页和物理内存页的映射

new操作完后就已经映射到了物理内存

![image-20230906211653515](images/image-20230906211653515.png)

3.free(p)怎么知道该释放多大的空间

malloc在分配空间的时候会多分配16byte的空间在memory首地址的前面，在free时，指针会向左移动16byte，在16个字节存储了内存块的描述信息(包含内存的大小)

![image-20230906211706988](images/image-20230906211706988.png)

4.free释放内存后，内存还在吗

如果通过mmap分配的大于128k的空间会立刻释放，通过break调用分配的小于128k的空间会重新回到内存池

 

